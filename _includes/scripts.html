<!-- Netlify Identity: 초대 링크(#invite_token=...) 접속 시 비밀번호 설정 화면 표시 -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}
<script>
(function() {
  // 플러그인 미사용(예: GitHub Pages) 시 data-icon으로 아이콘 채움
  document.querySelectorAll('.app-nav-ico[data-icon]').forEach(function(span) {
    if (span.textContent) return;
    var hex = (span.getAttribute('data-icon') || '25B6').trim();
    var chars = hex.split(',').map(function(h) {
      var code = parseInt(h.trim(), 16);
      return isNaN(code) ? '' : String.fromCodePoint(code);
    });
    span.textContent = chars.join('');
  });

  var body = document.body;
  if (!body) return;
  var posKey = 'sidebar-position';
  var posVal = localStorage.getItem(posKey) || 'left';
  if (posVal === 'right') body.classList.add('sidebar-right');
  else if (posVal === 'bottom') body.classList.add('sidebar-bottom');
  else if (posVal === 'top') body.classList.add('sidebar-top');
  var compactKey = 'sidebar-compact';
  if (localStorage.getItem(compactKey) === '1') body.classList.add('sidebar-compact');
  function reorderShell(contentFirst) {
    var shell = document.querySelector('.app-shell');
    var content = document.querySelector('.app-content');
    var sidebar = document.querySelector('.app-sidebar');
    if (!shell || !content || !sidebar) return;
    if (contentFirst) shell.insertBefore(content, sidebar);
    else shell.insertBefore(sidebar, content);
  }
  function initSidebarPositionSelect() {
    var sel = document.getElementById('sidebar-position-select');
    if (!sel) return;
    sel.value = posVal;
    if (!sel.dataset.sidebarPositionInited) {
      sel.dataset.sidebarPositionInited = '1';
      sel.addEventListener('change', function() {
        var v = this.value;
        try { localStorage.setItem(posKey, v); } catch (e) {}
        document.body.classList.toggle('sidebar-right', v === 'right');
        document.body.classList.toggle('sidebar-top', v === 'top');
        document.body.classList.toggle('sidebar-bottom', v === 'bottom');
        reorderShell(v === 'right' || v === 'bottom'); /* true: 콘텐츠 먼저, false: 사이드바 먼저 */
      });
    }
  }
  initSidebarPositionSelect();
  window.initSidebarPositionSelect = initSidebarPositionSelect;
  function initSidebarCompactCheckbox() {
    var cb = document.getElementById('sidebar-compact-checkbox');
    if (!cb) return;
    cb.checked = body.classList.contains('sidebar-compact');
    if (!cb.dataset.sidebarCompactInited) {
      cb.dataset.sidebarCompactInited = '1';
      cb.addEventListener('change', function() {
        var on = this.checked;
        try { localStorage.setItem(compactKey, on ? '1' : '0'); } catch (e) {}
        body.classList.toggle('sidebar-compact', on);
      });
    }
  }
  initSidebarCompactCheckbox();
  window.initSidebarCompactCheckbox = initSidebarCompactCheckbox;
})();
</script>
