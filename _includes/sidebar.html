<aside class="app-sidebar">
  <a class="app-title app-sidebar-title" href="{{ site.baseurl }}/" title="{{ site.title }}">
    {% if site.logo %}
    <span class="app-sidebar-title-logo-wrap">
      <img class="app-sidebar-title-logo" src="{{ site.baseurl }}/{{ site.logo }}" alt="{{ site.title }}" />
    </span>
    {% endif %}
    <span class="app-title-text">{{ site.title }}</span>
  </a>
  <nav class="app-nav">
    {% assign current = page.url %}
    {% include nav_path_utils.html %}
    {% assign section_pages = site.pages | where: "layout", "section" | where_exp: "item", "item.type == 'sidebar'" | sort: "url" %}
    {% if site.sidebar_order and site.sidebar_order.size > 0 %}
      {% for order_key in site.sidebar_order %}
        {% for section_page in section_pages %}
          {% assign segs = section_page.url | remove_first: "/" | split: "/" %}
          {% assign section_key = segs[0] %}
          {% if section_key == order_key %}
            {% assign group_base = section_page.url %}
            {% include nav_path_utils.html url=section_page.url %}
            {% assign group_base_alt = "/" | append: group_key | append: "/" %}
            {% assign group_pages_a = site.pages | where_exp: "item", "item.url contains group_base" | sort: "url" %}
            {% assign group_pages_b = site.pages | where_exp: "item", "item.url contains group_base_alt" | sort: "url" %}
            {% assign group_pages = group_pages_a | concat: group_pages_b | uniq | sort: "url" %}
            {% assign group_title = section_page.title | default: group_key | capitalize %}
            {% unless section_page.hide %}
            <div class="app-nav-group {% if page_group == group_key or current == group_base %}active{% endif %}">
              <a class="app-nav-item {% if current == group_base %}active{% endif %}" href="{{ group_base }}" title="{{ group_title }}">
                {% assign nav_icon_name = section_page.icon | default: "book" %}
                <span class="app-nav-ico app-nav-ico--svg" style="--ico: url('{{ site.baseurl }}/assets/svg/{{ nav_icon_name }}.svg');" aria-hidden="true"></span>
                <span class="app-nav-label">{{ group_title }}</span>
              </a>
              <div class="app-nav-sub">
                {% for p in group_pages %}
                  {% if p.hide != true and p.url != group_base %}
                  <a class="app-nav-sub-item {% if current == p.url %}active{% endif %}" href="{{ p.url }}" title="{{ p.title }}"><span class="app-nav-sub-item-text">{{ p.title }}</span></a>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            {% endunless %}
            {% break %}
          {% endif %}
        {% endfor %}
      {% endfor %}
    {% else %}
    {% for section_page in section_pages %}
      {% assign group_base = section_page.url %}
      {% include nav_path_utils.html url=section_page.url %}
      {% assign group_base_alt = "/" | append: group_key | append: "/" %}
      {% assign group_pages_a = site.pages | where_exp: "item", "item.url contains group_base" | sort: "url" %}
      {% assign group_pages_b = site.pages | where_exp: "item", "item.url contains group_base_alt" | sort: "url" %}
      {% assign group_pages = group_pages_a | concat: group_pages_b | uniq | sort: "url" %}
      {% assign group_title = section_page.title | default: group_key | capitalize %}
      {% unless section_page.hide %}
        <div class="app-nav-group {% if page_group == group_key or current == group_base %}active{% endif %}">
          <a class="app-nav-item {% if current == group_base %}active{% endif %}" href="{{ group_base }}" title="{{ group_title }}">
            {% assign nav_icon_name = section_page.icon | default: "book" %}
            <span class="app-nav-ico app-nav-ico--svg" style="--ico: url('{{ site.baseurl }}/assets/svg/{{ nav_icon_name }}.svg');" aria-hidden="true"></span>
            <span class="app-nav-label">{{ group_title }}</span>
          </a>
          <div class="app-nav-sub">
            {% for p in group_pages %}
              {% if p.hide != true and p.url != group_base %}
                <a class="app-nav-sub-item {% if current == p.url %}active{% endif %}" href="{{ p.url }}" title="{{ p.title }}"><span class="app-nav-sub-item-text">{{ p.title }}</span></a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endunless %}
    {% endfor %}
    {% endif %}
  </nav>
  {% assign footer_pages = site.pages | where: "layout", "section" | where_exp: "item", "item.type == 'sidebar_footer'" | sort: "url" %}
  {% assign topbar_pages = site.pages | where: "layout", "section" | where_exp: "item", "item.type == 'topbar'" | sort: "url" %}
  {% if footer_pages.size > 0 or topbar_pages.size > 0 %}
  <footer class="app-sidebar-footer">
    {% for fp in footer_pages %}
      {% unless fp.hide %}
      <a class="app-nav-item {% if page.url == fp.url %}active{% endif %}" href="{{ fp.url }}" title="{{ fp.title }}">
        {% assign footer_icon = fp.icon | default: "wrench" %}
        <span class="app-nav-ico app-nav-ico--svg" style="--ico: url('{{ site.baseurl }}/assets/svg/{{ footer_icon }}.svg');" aria-hidden="true"></span>
        <span class="app-nav-label">{{ fp.title }}</span>
      </a>
      {% endunless %}
    {% endfor %}
    {% for section_page in topbar_pages %}
      {% assign group_base = section_page.url %}
      {% include nav_path_utils.html url=section_page.url %}
      {% assign group_title = section_page.title | default: group_key | capitalize %}
      {% unless section_page.hide %}
      <a class="app-nav-item {% if page_group == group_key %}active{% endif %}" href="{{ group_base }}" title="{{ group_title }}">
        {% assign nav_icon_name = section_page.icon | default: "book" %}
        <span class="app-nav-ico app-nav-ico--svg" style="--ico: url('{{ site.baseurl }}/assets/svg/{{ nav_icon_name }}-solid.svg');" aria-hidden="true"></span>
        <span class="app-nav-label">{{ group_title }}</span>
      </a>
      {% endunless %}
    {% endfor %}
  </footer>
  {% endif %}
</aside>
